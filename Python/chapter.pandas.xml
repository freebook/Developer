<?xml version="1.0" encoding="UTF-8"?>
<chapter id="index"><?dbhtml dir="pandas" ?>
	<title>Pandas</title>
	<subtitle>Powerful data structures for data analysis, time series, and statistics</subtitle>
	<section>
		<title>安装 pandas</title>
		<screen>
		<![CDATA[
pip install pandas		
		]]>
		</screen>
		<para>安装 modin 加速插件</para>
		<screen>
		<![CDATA[
pip install modin[dask]		
		]]>
		</screen>
		<para>modin 的用法是将：</para>
		<screen>
		<![CDATA[
import pandas as pd
改为
import modin.pandas as pd		
		]]>
		</screen>
	</section>
	<section>
		<title>HTML 表格处理</title>
		<para>read_html() 可以萃取 HTML table 标签中的数据。</para>
		<screen>
		<![CDATA[
pip install lxml		
		]]>
		</screen>
		<para>获取页面中所有table的数据</para>
		<programlisting>
		<![CDATA[
import pandas as pd

url = "http://www.stats.gov.cn/tjsj/zxfb/202103/t20210330_1815829.html"
data = pd.read_html(url)

print(data)
		]]>
		</programlisting>
		<para>多个 table 会返回一个数组，通过数组下标可以读取指定表格。</para>
		<programlisting>
		<![CDATA[
import pandas as pd

url = "http://www.stats.gov.cn/tjsj/zxfb/202103/t20210330_1815829.html"
data = pd.read_html(url)[1]

print(data)		
		]]>
		</programlisting>
		<para>获取 html table 标签 id 属性为 oTable 的表格数据 </para>
		<programlisting>
		<![CDATA[
import pandas as pd

url = "http://fund.eastmoney.com/fund.html"
data = pd.read_html(url,attrs = {'id': 'oTable'})

print(data)		
		]]>
		</programlisting>
	</section>
	&section.pandas.excel.xml;
	<section>
		<title>将数据保存到CSV文件</title>
		<programlisting>
		<![CDATA[
import pandas as pd

months=[202001,202002,202003,202004,202005,202006,202007,202008,202009,202010,202011,202012]

for month in months:
    print(month)
    weather = pd.read_html(f'http://www.tianqihoubao.com/lishi/wanzhou/month/{month}.html', encoding='gb18030', header=0)[0]
    print(weather)
    weather.to_csv(f'/tmp/{month}天气预报数据.csv', mode='a+', index=False, header=False)		
		]]>
		</programlisting>
	</section>

	<section>
		<title>FAQ</title>
		<section>
			<title>xlrd.biffh.XLRDError: Excel xlsx file; not supported</title>
			<screen>
			<![CDATA[
neo@MacBook-Pro-Neo ~ % pip show xlrd
Name: xlrd
Version: 2.0.1
Summary: Library for developers to extract data from Microsoft Excel (tm) .xls spreadsheet files
Home-page: http://www.python-excel.org/
Author: Chris Withers
Author-email: chris@withers.org
License: BSD
Location: /Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages
Requires: 
Required-by: 			
			]]>
			</screen>
			<para>降级 xlrd 到 1.2.0 可以解决</para>
			<screen>
			<![CDATA[
pip uninstall xlrd
pip install xlrd==1.2.0			
			]]>
			</screen>
		</section>
		<section>
			<title>Missing optional dependency 'xlrd'</title>
			<para>提示错误</para>
			<screen>
		<![CDATA[
ImportError: Missing optional dependency 'xlrd'. Install xlrd >= 1.0.0 for Excel support Use pip or conda to install xlrd.		
		]]>
			</screen>
			<para>解决方案</para>
			<screen>
			<![CDATA[
neo@MacBook-Pro-Neo ~/workspace/netkiller-project % pip3 install openpyxl
Collecting openpyxl
  Downloading openpyxl-3.0.7-py2.py3-none-any.whl (243 kB)
     |████████████████████████████████| 243 kB 2.2 MB/s 
Collecting et-xmlfile
  Using cached et_xmlfile-1.0.1.tar.gz (8.4 kB)
Building wheels for collected packages: et-xmlfile
  Building wheel for et-xmlfile (setup.py) ... done
  Created wheel for et-xmlfile: filename=et_xmlfile-1.0.1-py3-none-any.whl size=8913 sha256=a4c964230c25014b55de927ac9284d184e6c729edf6f414cba97f3d94d3023aa
  Stored in directory: /Users/neo/Library/Caches/pip/wheels/bb/9b/ff/8fdf015c95a57224237bf88fbb9e45237cbe8177213bc13732
Successfully built et-xmlfile
Installing collected packages: et-xmlfile, openpyxl
Successfully installed et-xmlfile-1.0.1 openpyxl-3.0.7			
			]]>
			</screen>
		</section>
	</section>
</chapter>