<?xml version="1.0" encoding="UTF-8"?>
<chapter id="type">
	<title>数据类型</title>
	<section id="type">
		<title>type 数据类型检测</title>
		<para>http://docs.python.org/library/types.html</para>
		<screen>
		<![CDATA[
>>> type( [] ) == list
True
>>> type( {} ) == dict
True
>>> type( "" ) == str
True
>>> type( 0 ) == int
True
>>> class Test1 ( object ):
    pass
>>> class Test2 ( Test1 ):
    pass
>>> a = Test1()
>>> b = Test2()
>>> type( a ) == Test1
True
>>> type( b ) == Test2
True
>>> type( b ) == Test1
False
>>> isinstance( b, Test1 )
True
>>> isinstance( b, Test2 )
True
>>> isinstance( a, Test1 )
True
>>> isinstance( a, Test2 )
False
>>> isinstance( [], list )
True
>>> isinstance( {}, dict )
True
		]]>
		</screen>
		<screen>
		<![CDATA[
>>> a = []
>>> type(a)
<type 'list'>
>>> f = ()
>>> type(f)
<type 'tuple'>
		]]>
		</screen>
	</section>
	<section id="string">
		<title>String</title>
		<section id="str.fun">
			<title>String function</title>
			<section id="str.find">
				<title>str.find()</title>
				<para>找到字符，返回字符串位置。没有找到返回 -1</para>
				<screen><![CDATA[
"aaa bbb ccc".find('aaa')
				]]></screen>
			</section>
			<section id="str.replace">
				<title>str.find()</title>
				<para>查找并替换字符串</para>
				<screen><![CDATA[
a = 'hello word'
a.replace('word','python')
				]]></screen>
			</section>
		</section>
		<section>
			<title>Convert str to bytes in python</title>
			<programlisting role="python">
			<![CDATA[
>>> b = str.encode(y)
>>> type(b) >>> b b’Hello World!’
To alter from bytes to str, capitalize on bytes.decode().
>>> z = b”Hello World!”
>>> y = “Hello World!”
>>> type(z)

>>> type(y)

To alter from str to bytes, capitalize on str.encode().
>>> a = bytes.decode(z)
>>> type(a)

>>> a
‘Hello World!’


# to utf-8		
'BG7NYT'.encode('utf-8')
# to utf-16
'BG7NYT'.encode('utf-16')
			]]>
			</programlisting>
		</section>
		<section>
			<title>String format 字符串格式化输出</title>
			<para></para>
			<screen>
			<![CDATA[
strHello = "the length of (%s) is %d" %('Hello World',len('Hello World'))
print strHello			
			]]>
			</screen>
			<para>前导字符串加0</para>
			<screen>
			<![CDATA[
for i in range(5):
    print("%03d" % i)	

for i in range(100):
    print('{0:0>3d}'.format(i))    		
			]]>
			</screen>
			<section>
				<title>格式化字典输出</title>
				<screen>
				<![CDATA[
member = {'name':'neo','age':18}
'my name is {name},age is {age}'.format(**member)        #**dict				
				]]>
				</screen>
				<para>输出</para>
				<screen>
				<![CDATA[
>>> member = {'name':'neo','age':18}
>>> 'my name is {name},age is {age}'.format(**member) 
'my name is neo,age is 18'				
				]]>
				</screen>
			</section>
		</section>
		<section>
			<title>正则处理字符串</title>
			<screen>
			<![CDATA[ 
import re

string = "TMP AAAAAA\r\nMSG BBBB"

print(re.sub(r'(TMP|MSG)\s', "", string))

			]]>
			</screen>
		</section>
	</section>
	<section id="float">
		<title>float 浮点数值</title>
		<programlisting>
		<![CDATA[
for i in [12.12300, 12.00, 200.12000, 200.0]:
    print('{:g}'.format(i))		
		]]>
		</programlisting>
	</section>
	<section id="array">
		<title>Array</title>
		<section>
			<title>遍历数字</title>
			<programlisting>
			<![CDATA[
colours = ["RED","GREEN","BLUE"]
for colour in colours:
    print colour	
			]]>
			</programlisting>
			<para></para>
			<programlisting>
			<![CDATA[
colours = ["RED","GREEN","BLUE"]
for i in range(0, len(colours)):
    print i, colour[i]			
			]]>
			</programlisting>
		</section>
		<section>
			<title>split / join </title>
			<screen>
			<![CDATA[
>>> str = 'a|b|c|d|e'
>>> str.split("|")
['a', 'b', 'c', 'd', 'e']

>>> list = ['a', 'b', 'c', 'd', 'e']
>>> "|".join(list)
'a|b|c|d|e'
			]]>
			</screen>
		</section>
	</section>
	<section id="datetime">
		<title>日期和时间</title>
		<section>
			<title>当前时间</title>
			<programlisting>
			<![CDATA[
from datetime import datetime

print(datetime.today())
print(datetime.now())
print(datetime.now().date())
print(datetime.now().time())
			]]>
			</programlisting>
			<screen>
			<![CDATA[
2023-03-11 18:30:34.657155
2023-03-11 18:30:34.657176
2023-03-11
18:30:34.657182			
			]]>
			</screen>
			<screen>
			<![CDATA[
today = datetime.today()
yesterday = (today - timedelta(days=1)).date()			
			]]>
			</screen>
		</section>
		<section>
			<title>生成时间</title>
			<programlisting>
			<![CDATA[
from datetime import date
print(date(2002, 12, 31))			
			]]>
			</programlisting>
		</section>
		<section>
			<title>日期格式化</title>
			<screen>
			<![CDATA[
from datetime import datetime
datetime.today().strftime('%Y-%m-%d.%H:%M:%S')

timepoint = time.strftime('%Y-%m-%d.%H:%M:%S',time.localtime(time.time()))
			]]>
			</screen>
		</section>
		<section>
			<title>字符串转日期</title>
			<programlisting>
			<![CDATA[
from datetime import datetime

dt_str = '27/10/20 05:23:20'
dt_obj = datetime.strptime(dt_str, '%d/%m/%y %H:%M:%S')

print("The type of the date is now",  type(dt_obj))
print("The date is", dt_obj)			
			]]>
			</programlisting>
		</section>
		<section>
			<title>日期转字符串</title>
			<programlisting>
			<![CDATA[
from datetime import date
print(date(2002, 12, 31).strftime('%Y-%m-%d'))			
			]]>
			</programlisting>
		</section>

		<section>
			<title>日期运算</title>
			<section>
				<title>天数差</title>
				<programlisting>
				<![CDATA[
from datetime import datetime

begin='2023-02-01'
end='2023-02-28'

interval=datetime.strptime(end,'%Y-%m-%d').date() - datetime.strptime(begin,'%Y-%m-%d').date()
print(interval.days)
				]]>
				</programlisting>
			</section>
			<section>
				<title>月/周 首尾计算</title>
				<programlisting>
			<![CDATA[
from datetime import timedelta,datetime

now = datetime.now()

# 获取昨天日期：
yesterday = now - timedelta(days=1)
# 获取明天日期：
tomorrow = now + timedelta(days=1)			
			]]>
				</programlisting>
				<programlisting>
			<![CDATA[
# 获取本周第一天和最后一天：
this_week_start = now - timedelta(days=now.weekday())
this_week_end = now + timedelta(days=6-now.weekday())

# 获取上周第一天和最后一天：
last_week_start = now - timedelta(days=now.weekday()+7)
last_week_end = now - timedelta(days=now.weekday()+1)

# 获取上月第一天和最后一天:

last_month_end = this_month_start - timedelta(days=1) 
last_month_start = datetime.datetime(last_month_end.year, last_month_end.month, 1)

# 获取本季第一天和最后一天：

month = (now.month - 1) - (now.month - 1) % 3 + 1
this_quarter_start = datetime.datetime(now.year, month, 1)
this_quarter_end = datetime.datetime(now.year, month, calendar.monthrange(now.year, now.month)[1]) 

# 获取上季第一天和最后一天：

last_quarter_end = this_quarter_start - timedelta(days=1)
last_quarter_start = datetime.datetime(last_quarter_end.year, last_quarter_end.month - 2, 1)

# 获取本年第一天和最后一天：

this_year_start = datetime.datetime(now.year, 1, 1)
this_year_end = datetime.datetime(now.year + 1, 1, 1) - timedelta(days=1)

# 获取去年第一天和最后一天：

last_year_end = this_year_start - timedelta(days=1)
last_year_start = datetime.datetime(last_year_end.year, 1, 1) 
			]]>
				</programlisting>
			</section>
		</section>
		<section>
			<title>日期范围计算</title>
			<para>计算两个日期之间的月份</para>
			<programlisting>
			<![CDATA[
import calendar
import datetime

begin = "2017-11-15"
end = "2018-04-23"


def monthlist(begin, end):
    begin = datetime.datetime.strptime(begin, "%Y-%m-%d")
    end = datetime.datetime.strptime(end, "%Y-%m-%d")

    result = []
    while True:
        if begin.month == 12:
            next = begin.replace(year=begin.year+1, month=1, day=1)
        else:
            next = begin.replace(month=begin.month+1, day=1)
        if next > end:
            break

        day = calendar.monthrange(begin.year, begin.month)[1]

        result.append((begin.strftime("%Y-%m-%d"),
                      begin.replace(day=day).strftime("%Y-%m-%d")))
        begin = next
    result.append((begin.strftime("%Y-%m-%d"), end.strftime("%Y-%m-%d")))
    return result


lists = monthlist(begin, end)
print(lists)
for (b, e) in lists:
    print(b, e)
			
			]]>
			</programlisting>
		</section>
		<section>
			<title>日期排序</title>
			<programlisting>
			<![CDATA[
import datetime
 
list_time=["2018-05-01","2018-02-01","2018-07-10","2019-06-01"]
 
list_time1=sorted(list_time,key=lambda date:datetime.datetime.strptime(date,"%Y-%m-%d").timestamp())
 
print('before', list_time)
print('after', list_time1)

print('before', list_time)
print('min', min(list_time1), 'max', max(list_time1))			
			]]>
			</programlisting>
		</section>
	</section>
	<section id="bytes">
		<title>bytes 类型</title>
		<section>
			<title>bytes to string </title>
			<screen>
			<![CDATA[
.decode()
			]]>
			</screen>
		</section>
		<section>
			<title>BOM头</title>
			<screen><![CDATA[
BOM : fffe
BOM_BE : feff
BOM_LE : fffe
BOM_UTF8 : efbb bf
BOM_UTF16 : fffe
BOM_UTF16_BE : feff
BOM_UTF16_LE : fffe
BOM_UTF32 : fffe 0000
BOM_UTF32_BE : 0000 feff
BOM_UTF32_LE : fffe 0000
			]]></screen>
		</section>
		<section>
			<title>replace</title>
			<para>bytes类型的数据，替换方法，不要忘记b""</para>
			<programlisting>
			<![CDATA[
a = b"abc"
b = a.replace(b"a", b"f")
print(b)
			]]>
			</programlisting>
		</section>
		<section>
			<title>pack/unpack</title>
			<programlisting>
			<![CDATA[


			]]>
			</programlisting>
		</section>
	</section>

</chapter>
<chapter id="python.datastruct">
	<title>数据结构</title>
	<section id="data.list">
		<title>List</title>
		<para>随机抽取list成员</para>
		<screen><![CDATA[
import random

# random choice from a list
for i in range(5):
    print random.choice([1, 2, 3, 5, 9])
		]]></screen>
		<programlisting>
		<![CDATA[
test = []
test.append('1')
test.append('b')
test.append('c')
print(test)	
		]]>
		</programlisting>
	</section>
	<section id="data.set">
		<title>Set</title>

		<programlisting>
		<![CDATA[
>>> set = {'a','b','c'}
>>> set
set(['a', 'c', 'b'])

>>> set = {"one", "two", "three","one"}
>>> set
set(['three', 'two', 'one'])		
		]]>
		</programlisting>
		<programlisting>
		<![CDATA[
>>> set.add('four')
>>> set
set(['four', 'three', 'two', 'one'])
		]]>
		</programlisting>
		<programlisting>
		<![CDATA[
>>> ','.join(set);
'four,three,two,one'

>>> set('four,three,two,one'.split(','));
{'one', 'four', 'three', 'two'}

>>> fruit = [ 'banana', 'orange', 'pineapple' ]
>>> set(fruit)
{'banana', 'pineapple', 'orange'}		
		]]>
		</programlisting>
	</section>
	<section id="data.dict">
		<title>Dict 字典</title>
		<section>
			<title>随机选择字典的 key 和 value</title>
			<para>随机字典的 key 和 value</para>
			<screen>
			<![CDATA[
			<![CDATA[
names = {1: '张三', 2: '李四', 3: '王五', 4: '赵六', 5: '牛七', 6: '马八'}
print(random.choice(list(names.keys())))
print(random.choice(list(names.values())))			
			]]>
			</screen>
		</section>
		<section>
			<title>字典合并</title>
			<screen>
			<![CDATA[
dict1 = {'name','neo'}
dict2 = {'nickname','netkiller'}
dict1.update(dict2)
print(dict1)			
			]]>
			</screen>
			<para></para>
			<screen>
			<![CDATA[
{'name', 'neo', 'nickname', 'netkiller'}			
			]]>
			</screen>
		</section>
	</section>

</chapter>

<chapter id="class">
	<title>Class</title>
	<screen><![CDATA[
class MyClass:
    """A simple example class"""
    i = 12345
    def f(self):
        return 'hello world'

x = MyClass()
    ]]></screen>
	<section id="class.init">
		<title>__init__ 构造方法</title>
		<screen><![CDATA[
def __init__(self):
    self.data = []
        ]]></screen>
		<screen><![CDATA[
>>> class Complex:
...     def __init__(self, realpart, imagpart):
...         self.r = realpart
...         self.i = imagpart
...
>>> x = Complex(3.0, -4.5)
>>> x.r, x.i
        ]]></screen>
	</section>
	<section>
		<title>inner class(内嵌类)</title>
		<programlisting>
		<![CDATA[

#!/usr/bin/env python3
 
import os, sys
 
class parent:
	def __init__(self):
		self.name = 'parent'
 
	def getName(self):
		print(self.name)

	class child:
		def __init__(self):
			self.name = 'child'
 
		def getName(self):
			print(self.name)
		def getParentName(self):
			print(parent.name)
 
if __name__ == '__main__':
	child =  parent.child()
	child.getName()

	p = parent()
	p.getName()
	c =  p.child()
	c.getName()
	c.getParentName()		
		]]>
		</programlisting>
		<section>
			<title>内嵌 Class 继承</title>
			<programlisting>
			<![CDATA[
class Geometry:
    class Curve:
        def __init__(self,c=1):
            self.c = c                          #curvature parameter
            print ('Curvature %g'%self.c)
            pass                                #some codes

    class Line(Curve):
        def __init__(self):
            Geometry.Curve.__init__(self,0)     #the key point
            pass                                #some codes

g = Geometry()
C = g.Curve(0.5)
L = g.Line()			
			]]>
			</programlisting>
		</section>
	</section>
</chapter>