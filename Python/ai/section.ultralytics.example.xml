<?xml version="1.0" encoding="UTF-8"?>
<section id="yolo.example">
	<title>æ¡ˆä¾‹</title>
	<section>
		<title>è¯†åˆ«éªŒè¯ç </title>
		<para>åˆå§‹åŒ–ç¯å¢ƒ</para>
		<screen>
		<![CDATA[
neo@Netkiller-Mac-mini-M4 netkiller % python3 -m venv .venv
		]]>
		</screen>
		<para>æˆ‘ä½¿ç”¨çš„æ˜¯ fish shell</para>
		<screen>
		<![CDATA[
neo@Netkiller-Mac-mini-M4 netkiller % fish
Welcome to fish, the friendly interactive shell
Type help for instructions on how to use fish		
		]]>
		</screen>
		<para>åˆ‡æ¢åˆ° venv ç¯å¢ƒ</para>
		<screen>
		<![CDATA[
neo@Netkiller-Mac-mini-M4 ~/P/netkiller (yolo)> source .venv/bin/activate.fish 
(.venv) neo@Neo-Mac-mini-M4 ~/P/netkiller (yolo)> 		
		]]>
		</screen>
		<section>
			<title>å‡†å¤‡å­¦ä¹ ç´ æ</title>
			<para>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ captcha éšæœºç”ŸæˆéªŒè¯ç </para>
			<screen>
			<![CDATA[
(.venv) neo@Neo-Mac-mini-M4 ~/P/netkiller (yolo)> pip install captcha	
			]]>
			</screen>
			<para>ä¸ºäº†é™ä½å­¦ä¹ éš¾åº¦ï¼Œæˆ‘ä»¬ç”Ÿæˆ4ä¸ºçº¯æ•°å­—éªŒè¯ç ï¼Œå…¶ä¸­ 50 å¼ ç”¨äºè®­ç»ƒï¼Œ10å¼ ç”¨äºæµ‹è¯•</para>
			<programlisting>
			<![CDATA[
import os
import random
from captcha.image import ImageCaptcha

# captcha_character = list("0123456789abcdefghijklmnopqrstuvwxyz")
captcha_character = list("0123456789")
captcha_length = 4

if __name__ == "__main__":
    image = ImageCaptcha()
    for i in range(50):
        code = "".join(random.sample(captcha_character, captcha_length))

        path = "./captcha/images/{}_{}.png".format(i,code)
        print(code)
        image.write(code, path)
    for i in range(10):
        code = "".join(random.sample(captcha_character, captcha_length))

        path = "./captcha/test/{}_{}.png".format(i, code)
        print(code)
        image.write(code, path)
			]]>
			</programlisting>
		</section>
		<section>
			<title>å›¾åƒæ ‡æ³¨</title>
			<para>å®‰è£…å›¾åƒæ ‡æ³¨å·¥å…·</para>
			<screen>
			<![CDATA[
pip install labelme labelme2yolo			
			]]>
			</screen>
			<para>å¯åŠ¨ labelmeï¼Œç„¶åè¿›å…¥æ¼«é•¿è‹¦å“ˆå“ˆçš„æ ‡æ³¨å·¥ä½œ</para>
			<screen>
			<![CDATA[
(.venv) neo@Neo-Mac-mini-M4 ~/P/netkiller (yolo)> labelme
			]]>
			</screen>
			<para>æ ‡æ³¨å®Œæˆä¹‹åï¼Œä½¿ç”¨ labelme2yolo å·¥å…·å°† json è½¬æˆ yolo æ ¼å¼</para>
			<screen>
		<![CDATA[
(.venv) neo@Neo-Mac-mini netkiller % labelme2yolo --json_dir captcha/images
[2024-11-19T07:06:52Z INFO  labelme2yolo] Starting the conversion process...
[2024-11-19T07:06:52Z INFO  labelme2yolo] Read and parsed 20 JSON files.
  [Train] [00:00:00] [########################################] 16/16 (0s)
  [Val] [00:00:00] [########################################] 4/4 (0s)
[2024-11-19T07:06:52Z INFO  labelme2yolo] Creating dataset.yaml file...
[2024-11-19T07:06:52Z INFO  labelme2yolo] Conversion process completed successfully.

(.venv) neo@Neo-Mac-mini netkiller % ls captcha/images/YOLODataset 
dataset.yaml    images          labels		
			]]>
			</screen>
			<para>å°† YOLODataset å¤åˆ¶ datasets ç›®å½•</para>
			<screen>
			<![CDATA[
rm -rf datasets/YOLODataset 
mv captcha/images/YOLODataset datasets
			]]>
			</screen>
			<para>ä¿®æ”¹ captcha/images/YOLODataset/dataset.yaml æ–‡ä»¶ï¼Œç¡®è®¤ path è·¯å¾„æ­£ç¡®
			</para>
			<screen>
			<![CDATA[
path: /Users/neo/PycharmProjects/netkiller/datasets/YOLODataset
train: images/train
val: images/val
test:

names:
    0: 8
    1: 2
    2: 4
    3: 9
    4: 7
    5: 3
    6: 0
    7: 6
    8: 5
    9: 1
			
			]]>
			</screen>
		</section>
		<section>
			<title>å»ºç«‹æ¨¡å‹</title>
			<para>æ–°å»ºä¸€ä¸ªæ¨¡å‹ï¼Œå‚è€ƒ
				https://github.com/ultralytics/ultralytics/blob/main/ultralytics/cfg/models/11/yolo11.yaml
			</para>
			<screen>
			<![CDATA[
# Ultralytics YOLO ğŸš€, AGPL-3.0 license
# YOLO11 object detection model with P3-P5 outputs. For Usage examples see https://docs.ultralytics.com/tasks/detect

# Parameters
nc: 10 # number of classes
scales: # model compound scaling constants, i.e. 'model=yolo11n.yaml' will call yolo11.yaml with scale 'n'
  # [depth, width, max_channels]
  n: [0.50, 0.25, 1024] # summary: 319 layers, 2624080 parameters, 2624064 gradients, 6.6 GFLOPs
  s: [0.50, 0.50, 1024] # summary: 319 layers, 9458752 parameters, 9458736 gradients, 21.7 GFLOPs
  m: [0.50, 1.00, 512] # summary: 409 layers, 20114688 parameters, 20114672 gradients, 68.5 GFLOPs
  l: [1.00, 1.00, 512] # summary: 631 layers, 25372160 parameters, 25372144 gradients, 87.6 GFLOPs
  x: [1.00, 1.50, 512] # summary: 631 layers, 56966176 parameters, 56966160 gradients, 196.0 GFLOPs

# YOLO11n backbone
backbone:
  # [from, repeats, module, args]
  - [-1, 1, Conv, [64, 3, 2]] # 0-P1/2
  - [-1, 1, Conv, [128, 3, 2]] # 1-P2/4
  - [-1, 2, C3k2, [256, False, 0.25]]
  - [-1, 1, Conv, [256, 3, 2]] # 3-P3/8
  - [-1, 2, C3k2, [512, False, 0.25]]
  - [-1, 1, Conv, [512, 3, 2]] # 5-P4/16
  - [-1, 2, C3k2, [512, True]]
  - [-1, 1, Conv, [1024, 3, 2]] # 7-P5/32
  - [-1, 2, C3k2, [1024, True]]
  - [-1, 1, SPPF, [1024, 5]] # 9
  - [-1, 2, C2PSA, [1024]] # 10

# YOLO11n head
head:
  - [-1, 1, nn.Upsample, [None, 2, "nearest"]]
  - [[-1, 6], 1, Concat, [1]] # cat backbone P4
  - [-1, 2, C3k2, [512, False]] # 13

  - [-1, 1, nn.Upsample, [None, 2, "nearest"]]
  - [[-1, 4], 1, Concat, [1]] # cat backbone P3
  - [-1, 2, C3k2, [256, False]] # 16 (P3/8-small)

  - [-1, 1, Conv, [256, 3, 2]]
  - [[-1, 13], 1, Concat, [1]] # cat head P4
  - [-1, 2, C3k2, [512, False]] # 19 (P4/16-medium)

  - [-1, 1, Conv, [512, 3, 2]]
  - [[-1, 10], 1, Concat, [1]] # cat head P5
  - [-1, 2, C3k2, [1024, True]] # 22 (P5/32-large)

  - [[16, 19, 22], 1, Detect, [nc]] # Detect(P3, P4, P5)			
			]]>
			</screen>
			<para>ä¿®æ”¹ nc: 10 # number of classes æˆ‘ä»¬è®­ç»ƒçš„çº¯æ•°å­—éªŒè¯ç ï¼Œåªæœ‰ 0ï½9ï¼Œæ‰€ä»¥ nc æ˜¯ 10 ä¸ªåˆ†ç±»
			</para>

		</section>
		<section>
			<title>æ¨¡å‹è®­ç»ƒ</title>
			<screen>
			<![CDATA[
yolo task=detect mode=train model=captcha.yaml data=datasets/YOLODataset/dataset.yaml epochs=100 workers=0 batch=10 imgsz=320
			]]>
			</screen>
		</section>
		<section>
			<title>æ¨¡å‹æ£€éªŒ</title>
			<screen>
			<![CDATA[
yolo val model=runs/detect/train/weights/best.pt data=datasets/YOLODataset/dataset.yaml
			]]>
			</screen>
			<para></para>
			<programlisting>
			<![CDATA[
neo@Netkiller-Mac-mini-M4 ~/P/netkiller (yolo)> yolo val model=runs/detect/train/weights/best.pt data=datasets/YOLODataset/dataset.yaml
Ultralytics 8.3.34 ğŸš€ Python-3.12.7 torch-2.5.1 CPU (Apple M4)
captcha summary (fused): 238 layers, 2,584,102 parameters, 0 gradients, 6.3 GFLOPs
val: Scanning /Users/neo/PycharmProjects/netkiller/datasets/YOLODataset/labels/val.cache... 20 images, 0 backgrounds, 0 corrupt: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 20/20 [00:00<?, ?it/s]
                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 2/2 [00:00<00:00,  4.17it/s]
                   all         20         80      0.406      0.538      0.532      0.366
                     8          9          9      0.408      0.889      0.668      0.495
                     2          7          7      0.614      0.571      0.627      0.429
                     4          9          9      0.415      0.222      0.342      0.199
                     9          6          6      0.337      0.667      0.538      0.348
                     7          9          9      0.102      0.111      0.224      0.142
                     3          8          8      0.452      0.315      0.541      0.406
                     0          9          9      0.391      0.778      0.736      0.593
                     6         10         10      0.454        0.6      0.549      0.384
                     1         13         13      0.484      0.692      0.562      0.293
Speed: 0.2ms preprocess, 21.8ms inference, 0.0ms loss, 0.6ms postprocess per image
Results saved to /Users/neo/PycharmProjects/netkiller/runs/detect/val
ğŸ’¡ Learn more at https://docs.ultralytics.com/modes/val			
			]]>
			</programlisting>
		</section>
		<section>
			<title>éªŒè¯ç é¢„æµ‹</title>
			<para>æˆ‘ä»¬è®­ç»ƒå¥½çš„æ¨¡å‹ runs/detect/train/weights/best.ptï¼Œé¢„æµ‹çš„å›¾ç‰‡ captcha/test/0_5902.png</para>
			<screen>
			<![CDATA[
yolo predict model=runs/detect/train/weights/best.pt source=captcha/test/0_5902.png imgsz=320	
			]]>
			</screen>
			<para></para>
			<programlisting>
			<![CDATA[
from ultralytics import YOLO

# åŠ è½½æ¨¡å‹
model = YOLO('runs/detect/train/weights/best.pt')

# è¿›è¡Œé¢„æµ‹
results = model.predict('captcha/test/0_5902.png')

# æå–æ£€æµ‹ç»“æœ
for result in results:
    boxes = result.boxes.xyxy  # è¾¹ç•Œæ¡†åæ ‡
    scores = result.boxes.conf  # ç½®ä¿¡åº¦åˆ†æ•°
    classes = result.boxes.cls  # ç±»åˆ«ç´¢å¼•

    # å¦‚æœæœ‰ç±»åˆ«åç§°ï¼Œå¯ä»¥é€šè¿‡ç±»åˆ«ç´¢å¼•è·å–
    class_names = [model.names[int(cls)] for cls in classes]

    # æ‰“å°æ£€æµ‹ç»“æœ
    for box, score, class_name in zip(boxes, scores, class_names):
        print(f"Class: {class_name}, Score: {score:.2f}, Box: {box}")

    # å¯è§†åŒ–æ£€æµ‹ç»“æœ
    annotated_img = result.plot()

    # æ˜¾ç¤ºå›¾åƒ
    result.show()			
			]]>
			</programlisting>
		</section>
	</section>
	<!-- https://docs.ultralytics.com/datasets/segment/crack-seg/ -->
</section>